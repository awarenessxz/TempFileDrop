version: '3.7'

services:
  envoy:
    image: envoyproxy/envoy:v1.19-latest
    container_name: envoy
    hostname: envoy
    restart: unless-stopped
    networks:
      - proxy-net
    environment:
      - KEYCLOAK_URL=http://localhost:8080
      - KEYCLOAK_HOST=localhost
      - KEYCLOAK_PROTOCOL=http
      - KEYCLOAK_PORT=8080
      - KEYCLOAK_REALM=storage
      - SERVICE_NAME=storage-gateway
      - SERVICE_HOST=localhost
      - SERVICE_PORT=9090
      - SERVICE_HEALTHCHECK_PATH=/health
      - SERVICE_HEALTHCHECK_PORT=8081
      - OPA_HOST=localhost
      - OPA_PORT=9191
      - DISABLE_JWT_AUTHN
      - ENVOY_LOG_LEVEL=info
      - ENVOY_HEALTHCHECK_PORt=8070
      - ENVOY_PORT=80
      - TIMEOUT=15s
    ports:
      - 80:80
      - 8070:8070
    volumes:
      - ./envoy.yaml:/etc/envoy/envoy.yaml

networks:
  proxy-net:
    external:
      name: tempfiledrop_bridge